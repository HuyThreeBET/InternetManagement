Use Master;
Go

IF EXISTS (SELECT Name FROM sys.databases WHERE Name = 'InternetManagement')
BEGIN
    ALTER DATABASE InternetManagement SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE InternetManagement;
END
Go	

CREATE DATABASE InternetManagement;
Go

Use InternetManagement;
Go

CREATE TABLE [Role] (
  [Id] tinyint PRIMARY KEY IDENTITY(1, 1),
  [Name] nvarchar(255) NOT NULL DEFAULT ''
)
GO

CREATE TABLE [Account] (
  [Id] char(22) PRIMARY KEY NOT NULL,
  [AccountName] char(55) UNIQUE NOT NULL,
  [Passowrd] char(55) NOT NULL,
  [Sex] bit NOT NULL DEFAULT (1),
  [RoleId] tinyint NOT NULL DEFAULT (1),
  [CreateAt] datetime NOT NULL DEFAULT (getdate())
)
GO

CREATE TABLE [User] (
  [Id] char(22) PRIMARY KEY,
  [Balance] decimal(10, 3) NOT NULL DEFAULT (0)
)
GO

CREATE TABLE [Staff] (
  [Id] char(22) PRIMARY KEY,
  [FullName] nvarchar(255) NOT NULL DEFAULT '',
  [DayOfBirth] datetime NOT NULL,
  [State] bit NOT NULL DEFAULT (1),
  [DayOfWork] datetime NOT NULL DEFAULT (getdate()),
  [DayOff] datetime NOT NULL DEFAULT (getdate())
)
GO

CREATE TABLE [Decentralization] (
  [Id] char(22),
  [Permision] tinyint
)
GO

CREATE TABLE [Dish] (
  [Name] nvarchar(255) PRIMARY KEY,
  [Price] smallint NOT NULL DEFAULT (0),
  [Image] image NOT NULL
)
GO

CREATE TABLE [ComputerType] (
  [Id] smallint PRIMARY KEY IDENTITY(1, 1),
  [Name] nvarchar(255) NOT NULL,
  [Price] smallint NOT NULL DEFAULT (1)
)
GO

CREATE TABLE [Computer] (
  [Id] smallint PRIMARY KEY NOT NULL,
  [ComputerType] smallint,
  [State] bit NOT NULL DEFAULT (0)
)
GO

CREATE TABLE [Order] (
  [Id] int PRIMARY KEY IDENTITY(1, 1),
  [IdOfComputer] smallint NOT NULL,
  [NameOfDish] nvarchar(255),
  [Quantity] smallint NOT NULL DEFAULT (1),
  [TotalAmount] smallint NOT NULL DEFAULT (0),
  [CreateAt] datetime NOT NULL DEFAULT (getdate())
)
GO

CREATE TABLE [PlayTimeManagement] (
  [Id] int PRIMARY KEY IDENTITY(1, 1),
  [IdOfUser] char(22) NOT NULL,
  [IdOfComputer] smallint NOT NULL,
  [StartTime] datetime NOT NULL DEFAULT (getdate()),
  [EndTime] datetime NOT NULL DEFAULT (getdate())
)
GO

CREATE TABLE [OrderList] (
  [Id] int NOT NULL,
  [IdOfOrder] int NOT NULL
)
GO

CREATE INDEX [Role_index_0] ON [Role] ("Name")
GO

CREATE INDEX [Account_index_1] ON [Account] ("AccountName")
GO

CREATE INDEX [Staff_index_2] ON [Staff] ("Id")
GO

CREATE INDEX [Decentralization_index_3] ON [Decentralization] ("Permision")
GO

CREATE UNIQUE INDEX [Decentralization_index_4] ON [Decentralization] ("Id", "Permision")
GO

CREATE INDEX [Dish_index_5] ON [Dish] ("Name")
GO

CREATE INDEX [ComputerType_index_6] ON [ComputerType] ("Name")
GO

CREATE INDEX [Computer_index_7] ON [Computer] ("Id")
GO

CREATE INDEX [Computer_index_8] ON [Computer] ("ComputerType")
GO

CREATE INDEX [Order_index_9] ON [Order] ("Id")
GO

CREATE INDEX [Order_index_10] ON [Order] ("IdOfComputer")
GO

CREATE INDEX [PlayTimeManagement_index_11] ON [PlayTimeManagement] ("IdOfUser")
GO

CREATE INDEX [PlayTimeManagement_index_12] ON [PlayTimeManagement] ("IdOfComputer")
GO

CREATE INDEX [PlayTimeManagement_index_13] ON [PlayTimeManagement] ("StartTime")
GO

CREATE INDEX [OrderList_index_14] ON [OrderList] ("Id")
GO

CREATE INDEX [OrderList_index_15] ON [OrderList] ("IdOfOrder")
GO

CREATE UNIQUE INDEX [OrderList_index_16] ON [OrderList] ("Id", "IdOfOrder")
GO

ALTER TABLE [Account] ADD FOREIGN KEY ([RoleId]) REFERENCES [Role] ([Id])
GO

ALTER TABLE [User] ADD FOREIGN KEY ([Id]) REFERENCES [Account] ([Id])
GO

ALTER TABLE [Staff] ADD FOREIGN KEY ([Id]) REFERENCES [Account] ([Id])
GO

ALTER TABLE [Decentralization] ADD FOREIGN KEY ([Id]) REFERENCES [Account] ([Id])
GO

ALTER TABLE [Decentralization] ADD FOREIGN KEY ([Permision]) REFERENCES [Role] ([Id])
GO

ALTER TABLE [Computer] ADD FOREIGN KEY ([ComputerType]) REFERENCES [ComputerType] ([Id])
GO

ALTER TABLE [Order] ADD FOREIGN KEY ([IdOfComputer]) REFERENCES [Computer] ([Id])
GO

ALTER TABLE [Order] ADD FOREIGN KEY ([NameOfDish]) REFERENCES [Dish] ([Name])
GO

ALTER TABLE [PlayTimeManagement] ADD FOREIGN KEY ([IdOfUser]) REFERENCES [User] ([Id])
GO

ALTER TABLE [PlayTimeManagement] ADD FOREIGN KEY ([IdOfComputer]) REFERENCES [Computer] ([Id])
GO

ALTER TABLE [OrderList] ADD FOREIGN KEY ([Id]) REFERENCES [PlayTimeManagement] ([Id])
GO

ALTER TABLE [OrderList] ADD FOREIGN KEY ([IdOfOrder]) REFERENCES [Order] ([Id])
GO

SET IDENTITY_INSERT [dbo].[ComputerType] ON 

INSERT [dbo].[ComputerType] ([Id], [Name], [Price]) VALUES (1, N'I5 11400H', 7)
INSERT [dbo].[ComputerType] ([Id], [Name], [Price]) VALUES (2, N'I3 972G', 5)
INSERT [dbo].[ComputerType] ([Id], [Name], [Price]) VALUES (3, N'I9 11900H', 15)
SET IDENTITY_INSERT [dbo].[ComputerType] OFF
GO
SET IDENTITY_INSERT [dbo].[Role] ON 

INSERT [dbo].[Role] ([Id], [Name]) VALUES (4, N'Chủ quán nét')
INSERT [dbo].[Role] ([Id], [Name]) VALUES (1, N'Khách hàng')
INSERT [dbo].[Role] ([Id], [Name]) VALUES (2, N'Nhân viên')
INSERT [dbo].[Role] ([Id], [Name]) VALUES (3, N'Quản lí')
SET IDENTITY_INSERT [dbo].[Role] OFF
GO





