Use Master;
Go

IF EXISTS (SELECT Name FROM sys.databases WHERE Name = 'InternetShop')
BEGIN
    ALTER DATABASE InternetManagement SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE InternetManagement;
END
Go	

CREATE DATABASE InternetManagement;
Go

Use InternetManagement;
Go

CREATE TABLE [Role] (
  [Id] tinyint PRIMARY KEY IDENTITY(1, 1),
  [Name] nvarchar NOT NULL DEFAULT ''
)
GO

CREATE TABLE [Account] (
  [Id] smallint PRIMARY KEY IDENTITY(1, 1),
  [AccountName] char(55) UNIQUE NOT NULL DEFAULT '',
  [Passowrd] char(55) NOT NULL DEFAULT '',
  [RoleId] tinyint NOT NULL,
  [CreateAt] datetime NOT NULL DEFAULT (getdate())
)
GO

CREATE TABLE [Decentralization] (
  [Id] smallint,
  [Permision] tinyint
)
GO

CREATE TABLE [User] (
  [IdOfUser] smallint PRIMARY KEY,
  [Balance] decimal(9, 3) NOT NULL DEFAULT (0)
)
GO

CREATE TABLE [Staff] (
  [IdOfStaff] smallint PRIMARY KEY,
  [FullName] nvarchar(255) NOT NULL DEFAULT '',
  [State] bit NOT NULL DEFAULT (1),
  [DayOfWork] datetime NOT NULL DEFAULT (getdate()),
  [DayOff] datetime NOT NULL DEFAULT (getdate())
)
GO

CREATE TABLE [Dish] (
  [Name] nvarchar(255) PRIMARY KEY,
  [Price] int NOT NULL DEFAULT (0),
  [Image] image NOT NULL
)
GO

CREATE TABLE [Computer] (
  [Id] smallint PRIMARY KEY IDENTITY(1, 1),
  [State] bit NOT NULL DEFAULT (0)
)
GO

CREATE TABLE [Order] (
  [Id] smallint PRIMARY KEY IDENTITY(1, 1),
  [IdOfComputer] smallint NOT NULL,
  [NameOfDish] nvarchar(255),
  [Quantity] smallint NOT NULL DEFAULT (1),
  [TotalAmount] smallint NOT NULL DEFAULT (0),
  [CreateAt] datetime NOT NULL DEFAULT (getdate())
)
GO

CREATE TABLE [OrderList] (
  [Id] int NOT NULL,
  [IdOfOrder] smallint NOT NULL
)
GO

CREATE TABLE [PlayTimeManagement] (
  [Id] int PRIMARY KEY IDENTITY(1, 1),
  [IdOfUser] smallint NOT NULL,
  [IdOfComputer] smallint NOT NULL,
  [StartTime] datetime NOT NULL DEFAULT (getdate()),
  [EndTime] datetime NOT NULL DEFAULT (getdate())
)
GO

CREATE INDEX [Account_index_0] ON [Account] ("AccountName")
GO

CREATE INDEX [Decentralization_index_1] ON [Decentralization] ("Id")
GO

CREATE INDEX [Decentralization_index_2] ON [Decentralization] ("Permision")
GO

CREATE UNIQUE INDEX [Decentralization_index_3] ON [Decentralization] ("Id", "Permision")
GO

CREATE INDEX [User_index_4] ON [User] ("IdOfUser")
GO

CREATE INDEX [Staff_index_5] ON [Staff] ("IdOfStaff")
GO

CREATE INDEX [Dish_index_6] ON [Dish] ("Name")
GO

CREATE INDEX [Computer_index_7] ON [Computer] ("Id")
GO

CREATE INDEX [Order_index_8] ON [Order] ("Id")
GO

CREATE INDEX [Order_index_9] ON [Order] ("IdOfComputer")
GO

CREATE INDEX [Order_index_10] ON [Order] ("NameOfDish")
GO

CREATE INDEX [OrderList_index_11] ON [OrderList] ("Id")
GO

CREATE INDEX [OrderList_index_12] ON [OrderList] ("IdOfOrder")
GO

CREATE UNIQUE INDEX [OrderList_index_13] ON [OrderList] ("Id", "IdOfOrder")
GO

CREATE INDEX [PlayTimeManagement_index_14] ON [PlayTimeManagement] ("Id")
GO

CREATE INDEX [PlayTimeManagement_index_15] ON [PlayTimeManagement] ("IdOfUser")
GO

CREATE INDEX [PlayTimeManagement_index_16] ON [PlayTimeManagement] ("IdOfComputer")
GO

CREATE INDEX [PlayTimeManagement_index_17] ON [PlayTimeManagement] ("StartTime")
GO

ALTER TABLE [Account] ADD FOREIGN KEY ([RoleId]) REFERENCES [Role] ([Id])
GO

ALTER TABLE [Decentralization] ADD FOREIGN KEY ([Id]) REFERENCES [Account] ([Id])
GO

ALTER TABLE [Decentralization] ADD FOREIGN KEY ([Permision]) REFERENCES [Role] ([Id])
GO

ALTER TABLE [User] ADD FOREIGN KEY ([IdOfUser]) REFERENCES [Account] ([Id])
GO

ALTER TABLE [Staff] ADD FOREIGN KEY ([IdOfStaff]) REFERENCES [Account] ([Id])
GO

ALTER TABLE [Order] ADD FOREIGN KEY ([IdOfComputer]) REFERENCES [Computer] ([Id])
GO

ALTER TABLE [Order] ADD FOREIGN KEY ([NameOfDish]) REFERENCES [Dish] ([Name])
GO

ALTER TABLE [OrderList] ADD FOREIGN KEY ([Id]) REFERENCES [PlayTimeManagement] ([Id])
GO

ALTER TABLE [OrderList] ADD FOREIGN KEY ([IdOfOrder]) REFERENCES [Order] ([Id])
GO

ALTER TABLE [PlayTimeManagement] ADD FOREIGN KEY ([IdOfUser]) REFERENCES [User] ([IdOfUser])
GO

ALTER TABLE [PlayTimeManagement] ADD FOREIGN KEY ([IdOfComputer]) REFERENCES [Computer] ([Id])
GO





